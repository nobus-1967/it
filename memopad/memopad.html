<!DOCTYPE html>
<html lang="ru" xmlns="http://www.w3.org/1999/html">

<head>
    <meta charset="UTF-8">
    <title>MemoPad — консольный редактор и SQLite-база заметок</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Анатолий Щербина">
    <meta name="description"
          content="MemoPad — консольный редактор и SQLite-база заметок">
    <meta name="keywords"
          content="Python, SQL, SQLite, sqlite3, sqlite3-icu, pathlib, shutil,
          Prompt Toolkit, Rich, Markdown, Pyperclip, программа, CLI,
          командный интерфейс, база данных, СУБД, заметка, редактор,
          Анатолий Щербина">
    <link rel="stylesheet" href="memopad.css">
</head>

<body>
<header id="beginning">
    <h1><em>MemoPad</em> &mdash; консольный редактор и
        <em>SQLite</em>-база заметок</h1>
</header>
<nav>
    <p class="itpage"><a href="/index.html"
                         title="К списку заметок компьютерной тематики">&rarr;&nbsp;За
        компьютером</a></p>
    <figure><img src="img/memopad-logo.png" alt="Docker" height="194"
                 width="256"></figure>
    <ul class="navlinks">
        <li>
            <a href="#part01">
                О проекте <em>MemoPad</em>
            </a>
        </li>
        <li>
            <a href="#part02">
                Техническое задание
            </a>
        </li>
        <li>
            <a href="#part03">
                Работа с базой данных <em>SQLite</em>
            </a>
        </li>
        <li>
            <a href="#part04">
                Использование <em>Prompt Toolkit</em> для командной строки
            </a>
        </li>
        <li>
            <a href="#part05">
                Работа с буфером обмена
            </a>
        </li>
        <li>
            <a href="#part06">
                Отображение разметки <em>Markdown</em>
            </a>
        </li>
        <li>
            <a href="#part07">
                Взаимодействие с файловой системой
            </a>
        </li>
    </ul>
</nav>
<main>
    <section>
        <h2 id="part01">
            О проекте <em>MemoPad</em>
        </h2>
        <figure>
            <img src="img/memopad-start.png" alt="CLI-редактор заметок MemoPad"
                 height="629" width="866">
        </figure>
        <p><em>MemoPad</em> &mdash; программа для создания, редактирования и
            просмотра заметок в терминале, использующая
            <a href="https://www.sqlite.org/" title="СУБД SQLite"
               target="_blank"><em>SQLite</em></a> как базу заметок. Идея
            данной программы была подсказана проектом
            <a href="https://jrnl.sh/"
               title="Simple journal application for the command line"
               target="_blank"><em>jrnl</em></a>, тоже, кстати, созданном
               на языке программирования
            <a href="https://www.python.org/"
               title="Сайт языка Python" target="_blank"><em>Python 3</em></a>,
                но с другим интерфейсом и функционалом (см. раздел
                <a href="#part02">Техническое задание</a>). В итоге получился
                совершенно отличный от <em>jrnl</em> проект, с кодом которого
            можно познакомиться на
                <a href="https://github.com/nobus-1967/projects/tree/main/memopad/"
                   title="Исходный код проекта MemoPad на GitHub"
                   target="_blank"><em>GitHub</em></a>.</p>
            <p>Проект использует стандартную
                <a href="https://www.gnu.org/licenses/gpl-3.0.html"
                   title="GNU GPLv3"
                   target="_blank">общественную лицензию <em>GNU</em>
                    (<em>General Public License version 3)</em></a>.</p>
    </section>
    <section>
        <h2 id="part02">
            Техническое задание
        </h2>
        <figure>
            <img src="img/memopad-help.png"
                 alt="Контекстная справка в редакторе МемоPad"
                 height="629" width="866">
        </figure>
        <p>При создании <em>MemoPad</em> были поставлены следующие задачи:</p>
        <ol>
            <li>
                это должен быть редактор заметок для консоли (графический
                интерфейс пользователя &mdash;
                <abbr title="Graphical User Interface"><em>GUI</em></abbr>
                &mdash; изначально не предусматривался);
            </li>
            <li>
                работа с редактором заметок должна быть основана на интерфейсе
                командной строки
                (<abbr title="Command Line Interface"><em>CLI</em></abbr>),
                желательно с возможностью подсказки или автодополнения вводимых
                команд;
            </li>
            <li>
                для удобства пользователя приглашение командной строки должно
                выделяться шрифтом и/или цветом;
            </li>
            <li>
                по всем командам приложения и по работе с текстовой строкой
                должна быть доступна справочная информация (справка,
                <em>how-to</em>);
            </li>
            <li>
                заметки должны включать следующие поля:
                <ul>
                    <li>
                        ID (присваивается автоматически),
                    </li>
                    <li>
                        дата и время создания/редактирования (также
                        присваивается автоматически),
                    </li>
                    <li>
                        заголовок заметки,
                    </li>
                    <li>
                        основной текст и
                    </li>
                    <li>
                        хэштег;
                    </li>
                </ul>
            </li>
            <li>
                для основного текста заметки должна быть предусмотрена
                возможность ввода текста, состоящего из нескольких строк
                (абзацев);
            </li>
            <li>
                текст заметки может поддерживать форматирование с использованием
                элементов
                <a href="https://www.markdownguide.org/basic-syntax/"
                   title="Basic Syntax of Markdown"
                   target="_blank">языка разметки <em>Markdown</em></a>;
            </li>
            <li>
                программа по команде пользователя должна отображать либо
                последнюю заметку, либо несколько последних заметок в обратном
                хронологическом порядке (до 5-ти включительно), или же все
                заметки в порядке их создания, а также количество заметок в
                базе;
            </li>
            <li>
                необходим поиск заметки по её ID, дате создания/редактирования,
                фрагменту текста (в заголовке, теле заметки или хэштеге);
            </li>
            <li>
                должна быть предусмотрена возможно редактирования уже созданных
                заметок;
            </li>
            <li>
                пользователь должен получить возможность удалять заметки из
                базы (по одной или все сразу).
            </li>
        </ol>
        <p>Техническое задание вышло достаточно объёмным (впрочем, для любого
            текстового редактора эти функции являются базовыми). Ниже
            мы посмотрим на особенности реализации данных функций.</p>
    </section>
    <section>
        <h2 id="part03">
            Работа с базой данных <em>SQLite</em>
        </h2>
        <figure>
            <img src="img/memopad-recent.png"
                 alt="Просмотр последней заметки в редакторе МемоPad"
                 height="629" width="866">
        </figure>
        <p>Для хранения заметок и выборки из базы в проекте <em>MemoPad</em>
            используется встраиваемая реляционная
            <abbr title="Система управления базами данных">СУБД</abbr>
            <em>SQLite 3</em>.</p>
        <p>Данная <abbr title="Система управления базами данных">СУБД</abbr> не
            требует настройки сервера, её файловая структура состоит всего из
            одного файла (поэтому для базы заметок легко создать резервную копию
            и потом восстановить из этой копии, что и предусмотрено в нашей
            программе). Базовых возможностей <em>SQLite</em> вполне достаточно
            для того, чтобы хранить все элементы заметок (ID при этом
            создается автоматически в виде столбца <code>ROWID</code>), выводить
            результаты <em>SQL</em>-запросов и удалять кортежи с заметками.</p>
        <p>Для работы с <em>SQLite</em> используется стандартный модуль
            пайтоновской библиотеки &mdash;
            <a href="https://docs.python.org/3/library/sqlite3.html"
               title="DB-API 2.0 interface for SQLite databases"
               target="_blank"><code>sqlite3</code></a>.</p>
        <p>Единственная проблема, которую пришлось решать при использовании
            <em>SQLite</em>, состояла в том, что в готовой сборке данная
            <abbr title="Система управления базами данных">СУБД</abbr> не
            поддерживает регистронезависимый поиск по тексту, использующему
            символы за пределами стандартной кодовой таблицы
            <a href="https://www.unicode.org/charts/PDF/U0000.pdf"
               title="Unicode C0 Controls and Basic Latin"
               target="_blank"><em>ASCII</em></a>, в том числе и буквы
            кириллицы. Для работы с символами, отличными от базовой латиницы,
            необходимо либо самостоятельно собрать из предлагаемого
            разработчиками <em>SQLite</em> кода библиотеку для интеграции
            компонентов <em>Unicode</em>
            (<abbr title="International Components for Unicode"><em>ICU</em></abbr>),
            либо воспользоваться готовым расширением. В нашем проекте реализован
            второй путь &mdash; подключение готового расширения
            <a href="https://pypi.org/project/sqlite-icu/"
               title="Loadable ICU extension for sqlite"
               target="_blank"><code>sqlite-icu</code></a>.</p>
    </section>
    <section>
        <h2 id="part04">
            Использование <em>Prompt Toolkit</em> для командной строки
        </h2>
        <figure>
            <img src="img/memopad-hint.png"
                 alt="Подсказки по командам редактора МемоPad"
                 height="629" width="866">
        </figure>
        <p>Для создания полнофункциональной командной строки используется
            внешний модуль
            <a href="https://python-prompt-toolkit.readthedocs.io/"
               title="Library for building powerful interactive command line
               and terminal applications in Python"
               target="_blank"><em>Python Prompt Toolkit</em></a>. Он
            предоставляет богатые возможности настройки приглашения командной
            строки, в том числе и за счёт переопределения цветовой гаммы текста
            и фона (в проекте реализован вариант изменения цвета через
            управляющие последовательности <em>ANSI</em>). Данный модуль
            поддерживает ввод многострочного текста: завершение ввода текста
            происходит не при нажатии на клавишу <kbd>ENTER</kbd> (это действие
            создаёт новую строку), а путём последовательного нажатия клавиш
            <kbd>ESC</kbd> и <kbd>ENTER</kbd>.</p>
        <p>Также данный модуль даёт возможность определить подсказки для
            вводимых команд и даже собственный заголовок терминала. Примеры
            использования <em>Python Prompt Toolkit</em> можно посмотреть на
            <a href="https://github.com/prompt-toolkit/python-prompt-toolkit/tree/master/examples/"
               title="Примеры использования модуля prompt-toolkit для Python"
               target="_blank"><em>GitHub</em></a>.</p>
    </section>
    <section>
        <h2 id="part05">
            Работа с буфером обмена
        </h2>
        <figure>
            <img src="img/memopad-edit.png"
                 alt="Редактирование заметки из базы MemoPad"
                 height="629" width="866">
        </figure>
        <p>При редактировании заметки из базы данных доступны два варианта:</p>
        <ol>
            <li>
                ввод нового текста для заголовка, самой заметки и/или тега;
            </li>
            <li>
                редактирование прежнего текста данных элементов заметки.
            </li>
        </ol>
        <p>Редактирование прежнего текста реализовано через механизм копирования
            и вставки с использованием буфера обмена
            <abbr title="Операционная система"><em>ОС</em></abbr>. Пользователь
            вставляет старый текст (клавиши <kbd>CTRL+Y</kbd>), который
            уже был скопирован программой в буфер обмена, и затем его
            редактирует.</p>
        <p>Для реализации этой функции используется внешний модуль
            <a href="https://pyperclip.readthedocs.io/"
               title="Cross-platform Python module for copying and pasting text
               to the clipboard"
               target="_blank"><em>Pyperclip</em></a>. В
            системах <em>GNU/Linux</em> также может потребоваться установка
            дополнительной утилиты работы с буфером обмена
            (<code>xsel</code>, <code>xclip</code>) или же модуля
            <em>Python</em> (<code>gtk</code>/<code>PyQt4</code>).</p>
    </section>
    <section>
        <h2 id="part06">
            Отображение разметки <em>Markdown</em>
        </h2>
        <figure>
            <img src="img/memopad-search.png"
                 alt="Поиск заметки в базе MemoPad по тексту."
                 height="629" width="866">
        </figure>
        <p>В редакторе заметок реализована поддержка элементов языка разметки
            <em>Markdown</em> не только для отображения собственно заметок,
            но и для системных сообщений и справочной информации. Для вывода в
            терминале текста с разметкой <em>Markdown</em> используется простое
            и универсальное решение &mdash; внешний модуль
            <a href="https://rich.readthedocs.io/"
               title="Python library for writing rich text (with color and
               style) to the terminal"
               target="_blank"><em>Rich</em></a>.</p>
    </section>
    <section>
        <h2 id="part07">
            Взаимодействие с файловой системой
        </h2>
        <figure>
            <img src="img/memopad-backup.png"
                 alt="Резервное копирование в МемоPad"
                 height="629" width="866">
        </figure>
        <p>С целью определения путей в
            <abbr title="Операционная система"><em>ОС</em></abbr> и для работы с
            файлами и папками используется объектно-ориентированный модуль
            стандартной библиотеки
            <a href="https://docs.python.org/3/library/pathlib.html"
               title="Object-oriented filesystem paths"
               target="_blank"><code>pathlib</code></a>. Кстати, метод
            <code>Path.unlink()</code> также используется и для удаления базы
            заметок (удаление <abbr title="База данных">БД</abbr> напрямую
            пользователю недоступно, но является частью команды пересоздания
            <abbr title="База данных">БД</abbr> вместе с функцией создания новой
            <abbr title="База данных">БД</abbr>). При резервном копировании
            <abbr title="База данных">БД</abbr> задействована команда
            <code>shutil.copy()</code> из модуля
            <a href="https://docs.python.org/3/library/shutil.html"
               title="High-level file operations"
               target="_blank"><code>shutil</code></a>, также являющегося частью
            стандартной библиотеки языка <em>Python</em>.</p>
        <p>Для хранения файла <abbr title="База данных">БД</abbr> и его
            резервной копии программа <em>MemoPad</em> использует папку в
            пользовательском каталоге &mdash; <kbd>~/.memopad</kbd> (и создаёт
            такую папку при необходимости). Если при загрузке программы в этой
            папке отсутствует файл <kbd>memos.db</kbd>, программа проверяет,
            имеется ли в той же папке резервная копия
            (<kbd>memos.db.backup</kbd>) и, при её наличии, восстанавливает базу
            заметок. Если резервная копия не найдена, то создаётся пустая
            <abbr title="База данных">БД</abbr>.</p>
        <p>При выходе из программы пользователю предлагается создать новую
            резервную копию. Он может при работе с программой создать такую
            копию самостоятельно, а также восстановить базу заметок из её
            резервной копии. Если база данных по какой-то причине повреждена, а
            резервная копия отсутствует (или также повреждена), то пользователь
            может пересоздать <abbr title="База данных">БД</abbr> &mdash;
            конечно, в этом случае база заметок будет пустой.</p>
        <p>В общем, вот такой получился проект редактора заметок для терминала.
            Программа построена по модульному принципу: основные функции и
            выводимая текстовая информация собраны в тематические модули,
            которые затем подключаются к главному файлу <kbd>main.py</kbd>.</p>
        <p>Основные задачи, поставленные в техническом задании, были успешно
            реализованы (и даже больше, поскольку в <em>MemoPad</em>, как
            отмечалось выше, имплементирована возможность создания резервных
            копий базы заметок).</p>
    </section>
</main>
<footer>
    <p class="back"><a href="#beginning"
                    title="Вверх, к началу страницы">&uarr;&nbsp;К
        началу страницы</a></p>
    <address>&copy;&nbsp;<a href="/index.html" title="Сайт Анатолия Щербины">Анатолий
        Щербина</a>, 01.08.2022
    </address>
</footer>
</body>

</html>
